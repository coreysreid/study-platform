{% extends 'study/base.html' %}

{% block title %}{{ course.name }} - Study Platform{% endblock %}

{% block content %}
<div>
    <div style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
        <a href="{% if is_enrolled %}{% url 'course_list' %}{% else %}{% url 'course_catalog' %}{% endif %}" style="color: #667eea; text-decoration: none;">
            ‚Üê Back to {% if is_enrolled %}My Courses{% else %}Catalog{% endif %}
        </a>
        {% if not is_enrolled and course.created_by.username == 'system' %}
            <form method="post" action="{% url 'enroll_course' course.id %}">
                {% csrf_token %}
                <button type="submit" class="btn" style="background: #10b981; border: none; cursor: pointer;">
                    + Add to My Courses
                </button>
            </form>
        {% endif %}
    </div>
    
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem; border-radius: 10px; color: white; margin-bottom: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                    <h1 style="font-size: 2rem; margin: 0;">{{ course.name }}</h1>
                    {% if is_enrolled %}
                        <span style="background: rgba(16, 185, 129, 0.8); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.85rem;">
                            ‚úì Enrolled - {{ enrollment.get_status_display }}
                        </span>
                    {% elif course.created_by.username == 'system' %}
                        <span style="background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.85rem;">
                            üìö Public Course
                        </span>
                    {% endif %}
                </div>
                {% if course.code %}
                    <p style="opacity: 0.9; font-size: 1.1rem; margin-bottom: 1rem;">{{ course.code }}</p>
                {% endif %}
                {% if course.description %}
                    <p style="opacity: 0.9;">{{ course.description }}</p>
                {% endif %}
            </div>
            {% if course.created_by == request.user %}
                <a href="{% url 'course_edit' course.id %}" class="btn btn-secondary" style="background: rgba(255,255,255,0.2);">Edit Course</a>
            {% endif %}
        </div>
    </div>
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="color: #667eea;">Topics</h2>
        {% if course.created_by == request.user %}
            <a href="{% url 'topic_create_for_course' course.id %}" class="btn">+ Add Topic</a>
        {% endif %}
    </div>
    
    {% if topics %}
        <div style="display: grid; gap: 1rem;">
            {% for topic in topics %}
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <h3 style="color: #333; font-size: 1.2rem; margin-bottom: 0.5rem;">
                            {{ topic.name }}
                        </h3>
                        <p style="color: #666; margin-bottom: 0.5rem;">
                            {{ topic.description|truncatewords:20 }}
                        </p>
                        <small style="color: #999;">
                            {{ topic.flashcard_count }} flashcard{{ topic.flashcard_count|pluralize }}
                        </small>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="{% url 'topic_detail' topic.id %}" class="btn btn-secondary">View</a>
                        {% if course.created_by == request.user %}
                            <a href="{% url 'topic_edit' topic.id %}" class="btn btn-secondary">Edit</a>
                        {% endif %}
                        {% if topic.flashcard_count > 0 %}
                            <a href="{% url 'study_session' topic.id %}" class="btn">Study</a>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 10px;">
            <p style="font-size: 1.1rem; color: #666; margin-bottom: 1.5rem;">
                No topics yet.{% if course.created_by == request.user %} Add topics to start studying!{% endif %}
            </p>
            {% if course.created_by == request.user %}
                <a href="{% url 'topic_create_for_course' course.id %}" class="btn">Add First Topic</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
