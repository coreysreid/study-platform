{% extends 'study/base.html' %}

{% block title %}My Courses - Study Platform{% endblock %}

{% block content %}
<div>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1 style="color: #667eea;">My Courses</h1>
        <a href="{% url 'course_catalog' %}" class="btn" style="background: #10b981;">üìö Browse Catalog</a>
    </div>
    
    {% if enrollments or owned_courses %}
        <!-- Enrolled Courses -->
        {% if enrollments %}
            <h2 style="color: #667eea; margin-bottom: 1rem;">Enrolled Courses</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                {% for enrollment in enrollments %}
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <h3 style="font-size: 1.3rem; flex: 1;">{{ enrollment.course.name }}</h3>
                            <span style="background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.85rem; white-space: nowrap; margin-left: 0.5rem;">
                                {{ enrollment.get_status_display }}
                            </span>
                        </div>
                        {% if enrollment.course.code %}
                            <p style="opacity: 0.9; margin-bottom: 1rem;">{{ enrollment.course.code }}</p>
                        {% endif %}
                        <div style="background: rgba(255,255,255,0.2); padding: 0.75rem; border-radius: 5px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Topics:</span>
                                <strong>{{ enrollment.topic_count }}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Flashcards:</span>
                                <strong>{{ enrollment.flashcard_count }}</strong>
                            </div>
                        </div>
                        
                        <!-- Status Update Form -->
                        <form method="post" action="{% url 'update_enrollment_status' enrollment.course.id %}" style="margin-bottom: 1rem;">
                            {% csrf_token %}
                            <select name="status" onchange="this.form.submit()" style="width: 100%; padding: 0.5rem; border-radius: 5px; border: none;">
                                <option value="studying" {% if enrollment.status == 'studying' %}selected{% endif %}>üìñ Studying</option>
                                <option value="mastered" {% if enrollment.status == 'mastered' %}selected{% endif %}>‚úÖ Mastered</option>
                                <option value="shelved" {% if enrollment.status == 'shelved' %}selected{% endif %}>üìö Shelved</option>
                            </select>
                        </form>
                        
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{% url 'course_detail' enrollment.course.id %}" class="btn" style="background: white; color: #667eea; flex: 1; text-align: center; display: block;">
                                View Course
                            </a>
                            <form method="post" action="{% url 'unenroll_course' enrollment.course.id %}" style="flex: 0;" onsubmit="return confirm('Remove this course from your list?');">
                                {% csrf_token %}
                                <button type="submit" class="btn" style="background: rgba(239, 68, 68, 0.8); color: white; border: none; cursor: pointer; padding: 0.75rem 1rem;">
                                    üóëÔ∏è
                                </button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        <!-- Owned/Created Courses -->
        {% if owned_courses %}
            <h2 style="color: #667eea; margin-bottom: 1rem;">My Created Courses</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                {% for course in owned_courses %}
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 1.5rem; border-radius: 10px; color: white; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <h3 style="font-size: 1.3rem; flex: 1;">{{ course.name }}</h3>
                            <span style="background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.85rem; white-space: nowrap; margin-left: 0.5rem;">
                                üë§ Owner
                            </span>
                        </div>
                        {% if course.code %}
                            <p style="opacity: 0.9; margin-bottom: 1rem;">{{ course.code }}</p>
                        {% endif %}
                        <div style="background: rgba(255,255,255,0.2); padding: 0.75rem; border-radius: 5px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Topics:</span>
                                <strong>{{ course.topic_count }}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Flashcards:</span>
                                <strong>{{ course.flashcard_count }}</strong>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{% url 'course_detail' course.id %}" class="btn" style="background: white; color: #f5576c; flex: 1; text-align: center; display: block;">
                                View Course
                            </a>
                            <a href="{% url 'course_edit' course.id %}" class="btn btn-secondary" style="background: rgba(255,255,255,0.3); color: white;">
                                Edit
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% else %}
        <div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 10px;">
            <p style="font-size: 1.2rem; color: #666; margin-bottom: 1.5rem;">
                You haven't enrolled in or created any courses yet.
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <a href="{% url 'course_catalog' %}" class="btn" style="background: #10b981;">üìö Browse Course Catalog</a>
                <a href="{% url 'course_create' %}" class="btn" style="background: #667eea;">+ Create Course</a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
