from django.db import migrations


def seed_flashcards(apps, schema_editor):
    User = apps.get_model('auth', 'User')
    Course = apps.get_model('study', 'Course')
    Topic = apps.get_model('study', 'Topic')
    Flashcard = apps.get_model('study', 'Flashcard')

    system_user = User.objects.filter(username='system').first()
    if not system_user:
        return
    course = Course.objects.filter(name='Engineering Mathematics', created_by=system_user).first()
    if not course:
        return
    topics = {t.name: t for t in Topic.objects.filter(course=course)}

    def add_cards(topic_name, cards):
        topic = topics.get(topic_name)
        if not topic or Flashcard.objects.filter(topic=topic).exists():
            return
        for card in cards:
            Flashcard.objects.create(topic=topic, **card)

    # ------------------------------------------------------------------ #
    # Topic 1: Basic Arithmetic & Number Sense
    # ------------------------------------------------------------------ #
    add_cards('Basic Arithmetic & Number Sense', [
        {'question': 'What is the order of operations (PEMDAS/BODMAS)?',
         'answer': 'Parentheses/Brackets → Exponents/Orders → Multiplication & Division (left to right) → Addition & Subtraction (left to right).',
         'hint': 'Please Excuse My Dear Aunt Sally', 'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Evaluate: 3 + 4 × 2 − 1',
         'answer': '3 + 8 − 1 = 10. Multiplication before addition/subtraction.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'How do you add fractions with different denominators? Example: 1/3 + 1/4',
         'answer': 'Find LCD (12): 4/12 + 3/12 = 7/12.',
         'hint': 'LCD = LCM of denominators', 'difficulty': 'easy', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Find LCD', 'detail': 'LCM(3,4) = 12'},
                   {'move': 'Convert', 'detail': '1/3 = 4/12, 1/4 = 3/12'},
                   {'move': 'Add', 'detail': '4/12 + 3/12 = 7/12'}]},
        {'question': 'Multiply: (3/5) × (10/9)',
         'answer': '(3×10)/(5×9) = 30/45 = 2/3. Cancel common factors first: 3/9 = 1/3, 10/5 = 2, so 2/3.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Divide: (7/8) ÷ (14/4)',
         'answer': 'Multiply by reciprocal: (7/8) × (4/14) = 28/112 = 1/4.',
         'hint': 'KFC: Keep-Flip-Change', 'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Express 0.00045 in scientific notation.',
         'answer': '4.5 × 10⁻⁴. Move decimal 4 places right → negative exponent.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'How many significant figures does 0.00307 have?',
         'answer': '3 significant figures (3, 0, 7). Leading zeros are not significant.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Express 6.02 × 10²³ × 1.38 × 10⁻²³ in scientific notation.',
         'answer': '(6.02 × 1.38) × 10^(23−23) = 8.3076 × 10⁰ ≈ 8.31.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is 15% of 240?',
         'answer': '0.15 × 240 = 36.',
         'hint': '10% = 24, 5% = 12, total = 36', 'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'A ratio of boys to girls is 3:5. If there are 40 students total, how many boys?',
         'answer': 'Boys = 3/(3+5) × 40 = 3/8 × 40 = 15.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What is |−7| + |3 − 10|?',
         'answer': '7 + 7 = 14. Absolute value is distance from zero.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the LCM of 12 and 18.',
         'answer': 'Prime factorisation: 12 = 2²×3, 18 = 2×3². LCM = 2²×3² = 36.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the GCD of 48 and 36.',
         'answer': '48 = 2⁴×3, 36 = 2²×3². GCD = 2²×3 = 12.',
         'hint': 'Take lowest powers of common factors', 'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate: (−3)² − (−2)³',
         'answer': '9 − (−8) = 9 + 8 = 17.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Convert 3/8 to a decimal and percentage.',
         'answer': '3 ÷ 8 = 0.375 = 37.5%.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'A price increases from $80 to $100. What is the percentage increase?',
         'answer': '(100−80)/80 × 100% = 25%.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What are the prime factors of 360?',
         'answer': '360 = 2³ × 3² × 5.',
         'hint': 'Start dividing by 2, then 3, then 5', 'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Round 3.14159 to 3 significant figures.',
         'answer': '3.14 (keep 3 significant figures: 3, 1, 4).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Evaluate: √(144) + ∛(27)',
         'answer': '12 + 3 = 15.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'If x : y = 2 : 3 and y : z = 4 : 5, find x : y : z.',
         'answer': 'Make y consistent: x:y = 8:12, y:z = 12:15. So x:y:z = 8:12:15.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
    ])

    # ------------------------------------------------------------------ #
    # Topic 2: Algebra Fundamentals
    # ------------------------------------------------------------------ #
    add_cards('Algebra Fundamentals', [
        {'question': 'Solve for x: 3x − 7 = 14',
         'answer': '3x = 21, x = 7.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve: 2(3x − 1) = 4x + 6',
         'answer': '6x − 2 = 4x + 6 → 2x = 8 → x = 4.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Factorise: x² − 5x + 6',
         'answer': '(x − 2)(x − 3). Find two numbers that multiply to 6 and add to −5.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Factorise: x² − 16',
         'answer': '(x − 4)(x + 4). Difference of two squares: a² − b² = (a−b)(a+b).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the quadratic formula for ax² + bx + c = 0.',
         'answer': 'x = (−b ± √(b² − 4ac)) / (2a). The discriminant is b² − 4ac.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve: x² − 5x + 4 = 0 using the quadratic formula.',
         'answer': 'a=1, b=−5, c=4. Discriminant = 25−16 = 9. x = (5±3)/2 → x = 4 or x = 1.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Identify a, b, c', 'detail': 'a=1, b=−5, c=4'},
                   {'move': 'Compute discriminant', 'detail': 'Δ = (−5)² − 4(1)(4) = 25 − 16 = 9'},
                   {'move': 'Apply formula', 'detail': 'x = (5 ± √9)/2 = (5 ± 3)/2'},
                   {'move': 'Solutions', 'detail': 'x = 4 or x = 1'}]},
        {'question': 'Expand and simplify: (2x + 3)²',
         'answer': '4x² + 12x + 9. Use (a+b)² = a² + 2ab + b².',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the laws of exponents: product, quotient, power of a power.',
         'answer': 'aᵐ·aⁿ = aᵐ⁺ⁿ; aᵐ/aⁿ = aᵐ⁻ⁿ; (aᵐ)ⁿ = aᵐⁿ.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Simplify: (x³y²)² / (x²y)',
         'answer': 'x⁶y⁴ / x²y = x⁴y³.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve the system: 2x + y = 7, x − y = 2',
         'answer': 'Add equations: 3x = 9, x = 3. Then y = 7 − 6 = 1. Solution: (3, 1).',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Add equations', 'detail': '(2x + y) + (x − y) = 7 + 2 → 3x = 9'},
                   {'move': 'Solve for x', 'detail': 'x = 3'},
                   {'move': 'Back-substitute', 'detail': 'y = 7 − 2(3) = 1'}]},
        {'question': 'Solve: |2x − 3| = 7',
         'answer': 'Two cases: 2x−3 = 7 → x = 5; or 2x−3 = −7 → x = −2.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve the inequality: 3x − 2 > 7',
         'answer': '3x > 9, x > 3.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Simplify: (x² − 4) / (x + 2)',
         'answer': '(x−2)(x+2)/(x+2) = x − 2 (for x ≠ −2).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What does the discriminant b² − 4ac tell you about roots?',
         'answer': '>0: two real roots. =0: one repeated root. <0: two complex roots.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Complete the square: x² + 6x + 2 = 0',
         'answer': '$(x+3)^2 = 7 \\Rightarrow x = -3 \\pm \\sqrt{7}$',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [
             {'move': 'Move constant to right', 'detail': '$x^2 + 6x = -2$'},
             {'move': 'Apply $(b/2)^2$ rule', 'detail': '$b = 6$, so $(b/2)^2 = (6/2)^2 = 9$. Add 9 to both sides: $x^2 + 6x + 9 = -2 + 9$'},
             {'move': 'Factor left side', 'detail': '$(x + 3)^2 = 7$'},
             {'move': 'Solve for x', 'detail': '$x + 3 = \\pm\\sqrt{7}$, therefore $x = -3 \\pm \\sqrt{7}$'},
         ]},
        {'question': 'Perform polynomial long division: (2x³ − 3x + 1) ÷ (x − 2)',
         'answer': '2x² + 4x + 5 remainder 11. So (2x³ − 3x + 1)/(x−2) = 2x² + 4x + 5 + 11/(x−2).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Factorise completely: 2x³ − 8x',
         'answer': '2x(x² − 4) = 2x(x−2)(x+2).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Simplify: (3a²b)(2ab³)',
         'answer': '6a³b⁴.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'If f(x) = 3x² − 2x + 1, find f(−1).',
         'answer': 'f(−1) = 3(1) − 2(−1) + 1 = 3 + 2 + 1 = 6.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve: x² + 4 = 0',
         'answer': 'x² = −4 → x = ±2i. Two complex (imaginary) roots since discriminant < 0.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 3: Geometry
    # ------------------------------------------------------------------ #
    add_cards('Geometry', [
        {'question': 'State the Pythagorean theorem.',
         'answer': 'In a right triangle: a² + b² = c², where c is the hypotenuse.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the hypotenuse of a right triangle with legs 5 and 12.',
         'answer': 'c = √(25 + 144) = √169 = 13.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Area of a circle with radius r.',
         'answer': 'A = πr².',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Area of a triangle with base b and height h.',
         'answer': 'A = ½bh.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Area of a trapezoid with parallel sides a and b, height h.',
         'answer': 'A = ½(a + b)h.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Volume of a sphere with radius r.',
         'answer': 'V = (4/3)πr³.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Volume of a cylinder with radius r and height h.',
         'answer': 'V = πr²h.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Volume of a cone with radius r and height h.',
         'answer': 'V = (1/3)πr²h. One-third the volume of the enclosing cylinder.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the distance between points (1, 2) and (4, 6).',
         'answer': 'd = √((4−1)² + (6−2)²) = √(9+16) = √25 = 5.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the midpoint of the segment joining (2, 4) and (8, −2).',
         'answer': 'M = ((2+8)/2, (4+(−2))/2) = (5, 1).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the slope of a line through (1, 3) and (4, 9)?',
         'answer': 'm = (9−3)/(4−1) = 6/3 = 2.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'When are two lines perpendicular?',
         'answer': 'Their slopes multiply to −1: m₁ × m₂ = −1.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the equation of a line with slope 3 through (1, 4).',
         'answer': 'y − 4 = 3(x − 1) → y = 3x + 1.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the three Pythagorean triples you should memorise.',
         'answer': '(3, 4, 5), (5, 12, 13), (8, 15, 17). Multiples of these also work.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What is the sum of interior angles of a polygon with n sides?',
         'answer': '(n − 2) × 180°.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Surface area of a sphere with radius r.',
         'answer': 'SA = 4πr².',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Surface area of a cylinder (including both ends) with radius r, height h.',
         'answer': 'SA = 2πr² + 2πrh = 2πr(r + h).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Two similar triangles have sides in ratio 2:3. What is the ratio of their areas?',
         'answer': '4:9. Area scales as the square of the linear scale factor.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the length of an arc with radius 5 and central angle 60°.',
         'answer': 'Arc = (60/360) × 2π(5) = (1/6) × 10π = 5π/3.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the equation of a circle with centre (h, k) and radius r?',
         'answer': '(x − h)² + (y − k)² = r².',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 4: Trigonometry Fundamentals
    # ------------------------------------------------------------------ #
    add_cards('Trigonometry Fundamentals', [
        {'question': 'State SOH-CAH-TOA.',
         'answer': 'sin θ = Opposite/Hypotenuse; cos θ = Adjacent/Hypotenuse; tan θ = Opposite/Adjacent.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What are the exact values of sin, cos, tan for 30°, 45°, 60°?',
         'answer': '30°: sin=1/2, cos=√3/2, tan=1/√3. 45°: sin=cos=1/√2, tan=1. 60°: sin=√3/2, cos=1/2, tan=√3.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the fundamental Pythagorean identity.',
         'answer': 'sin²θ + cos²θ = 1. Derived from Pythagoras applied to the unit circle.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What are the two other Pythagorean identities (divide by cos²θ and sin²θ)?',
         'answer': 'tan²θ + 1 = sec²θ; cot²θ + 1 = csc²θ.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define the reciprocal trig functions.',
         'answer': 'csc θ = 1/sin θ; sec θ = 1/cos θ; cot θ = 1/tan θ.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Convert 135° to radians.',
         'answer': '135 × π/180 = 3π/4 radians.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Convert 5π/6 radians to degrees.',
         'answer': '5π/6 × 180/π = 150°.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the sine rule.',
         'answer': 'a/sin A = b/sin B = c/sin C. Used when you know two angles and a side, or two sides and a non-included angle.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the cosine rule.',
         'answer': 'c² = a² + b² − 2ab cos C. Used when you know two sides and the included angle, or all three sides.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the double angle formulas for sin and cos.',
         'answer': 'sin 2θ = 2 sin θ cos θ; cos 2θ = cos²θ − sin²θ = 2cos²θ − 1 = 1 − 2sin²θ.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the sum formula: sin(A + B)',
         'answer': 'sin(A + B) = sin A cos B + cos A sin B.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the sum formula: cos(A + B)',
         'answer': 'cos(A + B) = cos A cos B − sin A sin B.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve for θ in [0°, 360°]: sin θ = 1/2',
         'answer': 'θ = 30° and θ = 150° (sin is positive in Q1 and Q2).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve for θ in [0°, 360°]: cos θ = −√3/2',
         'answer': 'θ = 150° and θ = 210° (cos is negative in Q2 and Q3).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'In which quadrants is tan positive?',
         'answer': 'Quadrants I and III. (CAST rule: C=Q4 cos+, A=Q1 all+, S=Q2 sin+, T=Q3 tan+)',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What is the period of sin θ and cos θ? What about tan θ?',
         'answer': 'sin and cos: period = 2π. tan: period = π.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Prove: sin²θ + cos²θ = 1 using a right triangle.',
         'answer': 'With hypotenuse r: sin θ = y/r, cos θ = x/r. sin²θ + cos²θ = (y²+x²)/r² = r²/r² = 1.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the area of a triangle with sides a=7, b=5 and included angle C=60°.',
         'answer': 'Area = ½ab sin C = ½(7)(5) sin 60° = (35/2)(√3/2) = 35√3/4 ≈ 15.16.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Express 3sin x + 4cos x in the form R sin(x + φ).',
         'answer': 'R = √(3² + 4²) = 5. tan φ = 4/3, φ = 53.13°. Result: 5 sin(x + 53.13°).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the general solution of sin θ = sin α?',
         'answer': 'θ = nπ + (−1)ⁿα for integer n. (Equivalently θ = α + 2kπ or θ = π−α + 2kπ)',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 5: Pre-Calculus
    # ------------------------------------------------------------------ #
    add_cards('Pre-Calculus', [
        {'question': 'What is the domain of f(x) = √(x − 3)?',
         'answer': 'x − 3 ≥ 0, so x ≥ 3. Domain: [3, ∞).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the range of f(x) = x²?',
         'answer': '[0, ∞). A square is never negative.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'If f(x) = 2x + 1 and g(x) = x², find (f ∘ g)(x).',
         'answer': 'f(g(x)) = f(x²) = 2x² + 1.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the inverse of f(x) = 3x − 5.',
         'answer': 'Swap x and y: x = 3y − 5 → y = (x+5)/3. So f⁻¹(x) = (x+5)/3.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the laws of logarithms: product, quotient, power.',
         'answer': 'log(ab) = log a + log b; log(a/b) = log a − log b; log(aⁿ) = n log a.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve: 2^x = 32',
         'answer': '2^x = 2^5, so x = 5.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve: ln(x) = 3',
         'answer': 'x = e³ ≈ 20.09.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Simplify: log₂(8) + log₂(4)',
         'answer': 'log₂(8×4) = log₂(32) = 5.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the change-of-base formula?',
         'answer': 'log_b(x) = ln(x)/ln(b) = log(x)/log(b).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Add complex numbers: (3 + 2i) + (1 − 5i)',
         'answer': '(3+1) + (2−5)i = 4 − 3i.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Multiply complex numbers: (2 + 3i)(1 − 2i)',
         'answer': '2(1) + 2(−2i) + 3i(1) + 3i(−2i) = 2 − 4i + 3i − 6i² = 2 − i + 6 = 8 − i.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Express 1 + i in polar (modulus-argument) form.',
         'answer': 'r = √2, θ = 45° = π/4. So 1 + i = √2 (cos π/4 + i sin π/4) = √2 e^(iπ/4).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {"question": "State De Moivre's theorem.",
         'answer': '(r(cos θ + i sin θ))ⁿ = rⁿ(cos nθ + i sin nθ). Useful for computing powers of complex numbers.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the nth term of an arithmetic sequence with first term a and common difference d?',
         'answer': 'aₙ = a + (n−1)d.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Sum of the first n terms of an arithmetic series.',
         'answer': 'Sₙ = n/2 (2a + (n−1)d) = n/2 (first + last).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the nth term of a geometric sequence with first term a and ratio r?',
         'answer': 'aₙ = a · rⁿ⁻¹.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Sum to infinity of a geometric series (|r| < 1).',
         'answer': 'S∞ = a / (1 − r).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What does it mean for a function to be even? Odd?',
         'answer': 'Even: f(−x) = f(x), symmetric about y-axis (e.g. x²). Odd: f(−x) = −f(x), symmetric about origin (e.g. x³).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Informally define the limit: lim(x→a) f(x) = L.',
         'answer': 'As x approaches a (from either side), f(x) gets arbitrarily close to L. The function need not be defined at x=a.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate: lim(x→0) (sin x / x)',
         'answer': '1. This is a standard limit — the fundamental result linking sin x and x near zero.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 6: Differential Calculus
    # ------------------------------------------------------------------ #
    add_cards('Differential Calculus', [
        {'question': 'State the limit definition of the derivative.',
         'answer': "f'(x) = lim(h→0) [f(x+h) − f(x)] / h.",
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate using the power rule: f(x) = xⁿ.',
         'answer': "f'(x) = nxⁿ⁻¹.",
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate: f(x) = 5x³ − 2x² + 7x − 3',
         'answer': "f'(x) = 15x² − 4x + 7.",
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the product rule.',
         'answer': '(uv)′ = u′v + uv′.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate: f(x) = x² sin x using the product rule.',
         'answer': "f'(x) = 2x sin x + x² cos x.",
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the quotient rule.',
         'answer': '(u/v)′ = (u′v − uv′) / v².',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the chain rule.',
         'answer': 'If y = f(g(x)), then dy/dx = f′(g(x)) · g′(x).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate: y = (3x + 1)⁵ using the chain rule.',
         'answer': "y' = 5(3x+1)⁴ · 3 = 15(3x+1)⁴.",
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate: sin x, cos x, tan x.',
         'answer': 'd/dx(sin x) = cos x; d/dx(cos x) = −sin x; d/dx(tan x) = sec²x.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate: eˣ and ln x.',
         'answer': 'd/dx(eˣ) = eˣ; d/dx(ln x) = 1/x.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate implicitly: x² + y² = 25.',
         'answer': '2x + 2y dy/dx = 0 → dy/dx = −x/y.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Differentiate both sides w.r.t. x', 'detail': '2x + 2y(dy/dx) = 0'},
                   {'move': 'Isolate dy/dx', 'detail': 'dy/dx = −x/y'}]},
        {'question': 'Evaluate lim(x→∞) (3x² + 1) / (x² − 2) using L\'Hôpital or leading terms.',
         'answer': 'Divide by x²: (3 + 1/x²) / (1 − 2/x²) → 3/1 = 3.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Apply L\'Hôpital\'s rule to: lim(x→0) (eˣ − 1) / x',
         'answer': '0/0 form. Differentiate numerator and denominator: eˣ/1 → e⁰ = 1.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the critical points of f(x) = x³ − 3x.',
         'answer': "f'(x) = 3x² − 3 = 0 → x² = 1 → x = ±1.",
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Use the second derivative test to classify the critical points of f(x) = x³ − 3x.',
         'answer': "f''(x) = 6x. At x=1: f''=6>0 → local min. At x=−1: f''=−6<0 → local max.",
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'A ladder 10m long leans against a wall. The foot slides out at 1 m/s. How fast is the top falling when the foot is 6 m from the wall?',
         'answer': 'x²+y²=100. Diff: 2x(dx/dt)+2y(dy/dt)=0. At x=6, y=8: 2(6)(1)+2(8)(dy/dt)=0 → dy/dt=−3/4 m/s.',
         'difficulty': 'hard', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Set up equation', 'detail': 'x² + y² = 100'},
                   {'move': 'Differentiate w.r.t. time', 'detail': '2x(dx/dt) + 2y(dy/dt) = 0'},
                   {'move': 'Find y at x=6', 'detail': 'y = √(100−36) = 8'},
                   {'move': 'Substitute and solve', 'detail': '12(1) + 16(dy/dt) = 0 → dy/dt = −3/4 m/s'}]},
        {'question': 'Find the absolute maximum of f(x) = −x² + 4x on [0, 5].',
         'answer': "f'= −2x+4=0 → x=2, f(2)=4. Check endpoints: f(0)=0, f(5)=−5. Max = 4 at x=2.",
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the mean value theorem.',
         'answer': 'If f is continuous on [a,b] and differentiable on (a,b), there exists c∈(a,b) such that f′(c) = (f(b)−f(a))/(b−a).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate: y = ln(sin x)',
         'answer': 'y′ = (1/sin x) · cos x = cot x.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Differentiate: y = e^(x²)',
         'answer': "y' = e^(x²) · 2x = 2xe^(x²).",
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 7: Integral Calculus
    # ------------------------------------------------------------------ #
    add_cards('Integral Calculus', [
        {'question': 'State the Fundamental Theorem of Calculus (Part 1).',
         'answer': 'If F(x) = ∫ₐˣ f(t) dt, then F′(x) = f(x). Differentiation and integration are inverse operations.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Fundamental Theorem of Calculus (Part 2).',
         'answer': '∫ₐᵇ f(x) dx = F(b) − F(a) where F is any antiderivative of f.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Integrate using the power rule: ∫ xⁿ dx (n ≠ −1)',
         'answer': 'xⁿ⁺¹/(n+1) + C.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate: ∫(2x³ − 5x + 3) dx',
         'answer': 'x⁴/2 − 5x²/2 + 3x + C.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate: ∫₀² (3x² + 1) dx',
         'answer': '[x³ + x]₀² = (8 + 2) − (0) = 10.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Use u-substitution to evaluate: ∫ 2x(x² + 1)⁴ dx',
         'answer': 'Let u = x²+1, du = 2x dx. Integral becomes ∫ u⁴ du = u⁵/5 + C = (x²+1)⁵/5 + C.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Choose u', 'detail': 'u = x² + 1'},
                   {'move': 'Compute du', 'detail': 'du = 2x dx'},
                   {'move': 'Substitute', 'detail': '∫ u⁴ du'},
                   {'move': 'Integrate', 'detail': 'u⁵/5 + C = (x²+1)⁵/5 + C'}]},
        {'question': 'Integrate by parts: ∫ x eˣ dx',
         'answer': 'u=x, dv=eˣdx → du=dx, v=eˣ. Result: xeˣ − eˣ + C = eˣ(x−1) + C.',
         'hint': 'LIATE: choose u as the "higher priority" function (Logs, Inverse trig, Algebraic, Trig, Exponential)',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Choose u and dv', 'detail': 'u = x, dv = eˣ dx'},
                   {'move': 'Compute du and v', 'detail': 'du = dx, v = eˣ'},
                   {'move': 'Apply formula ∫u dv = uv − ∫v du', 'detail': 'xeˣ − ∫eˣ dx'},
                   {'move': 'Integrate', 'detail': 'xeˣ − eˣ + C'}]},
        {'question': 'Integrate by parts: ∫ ln x dx',
         'answer': 'u=ln x, dv=dx → du=1/x dx, v=x. Result: x ln x − x + C.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Decompose into partial fractions: 1/((x+1)(x−2))',
         'answer': 'A/(x+1) + B/(x−2). Multiply out: A(x−2)+B(x+1)=1. At x=2: 3B=1→B=1/3. At x=−1: −3A=1→A=−1/3.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Set up partial fractions', 'detail': '1/((x+1)(x−2)) = A/(x+1) + B/(x−2)'},
                   {'move': 'Multiply through', 'detail': 'A(x−2) + B(x+1) = 1'},
                   {'move': 'Solve at x=2', 'detail': '3B = 1 → B = 1/3'},
                   {'move': 'Solve at x=−1', 'detail': '−3A = 1 → A = −1/3'}]},
        {'question': 'What is the area between f(x) = x² and g(x) = x on [0, 1]?',
         'answer': '∫₀¹ |x − x²| dx = ∫₀¹ (x − x²) dx = [x²/2 − x³/3]₀¹ = 1/2 − 1/3 = 1/6.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate: ∫ sin x dx and ∫ cos x dx',
         'answer': '∫ sin x dx = −cos x + C; ∫ cos x dx = sin x + C.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate: ∫ eˣ dx and ∫ 1/x dx',
         'answer': '∫ eˣ dx = eˣ + C; ∫ 1/x dx = ln|x| + C.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Volume of revolution (disk method): rotating y = f(x) around the x-axis.',
         'answer': 'V = π ∫ₐᵇ [f(x)]² dx.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the volume when y = √x, 0 ≤ x ≤ 4 is rotated about the x-axis.',
         'answer': 'V = π ∫₀⁴ x dx = π [x²/2]₀⁴ = π(8) = 8π.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate the improper integral: ∫₁^∞ 1/x² dx',
         'answer': 'lim(b→∞) [−1/x]₁ᵇ = lim(b→∞) (−1/b + 1) = 1. Converges to 1.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Use trig substitution for ∫ √(1 − x²) dx',
         'answer': 'Let x = sin θ, dx = cos θ dθ. √(1−x²) = cos θ. ∫ cos²θ dθ = θ/2 + sin 2θ/4 + C. Back-substitute.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate: ∫₀^π sin x dx',
         'answer': '[−cos x]₀^π = (−cos π) − (−cos 0) = 1 + 1 = 2.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What integration technique to use for ∫ 1/(x²+1) dx?',
         'answer': 'Recognise: d/dx(arctan x) = 1/(x²+1). So ∫ 1/(x²+1) dx = arctan x + C.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 8: Multivariable Calculus
    # ------------------------------------------------------------------ #
    add_cards('Multivariable Calculus', [
        {'question': 'What is a partial derivative ∂f/∂x?',
         'answer': 'Derivative of f with respect to x, treating all other variables as constants.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find ∂f/∂x and ∂f/∂y for f(x,y) = x²y + 3y².',
         'answer': '∂f/∂x = 2xy; ∂f/∂y = x² + 6y.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the gradient vector ∇f of f(x,y)?',
         'answer': '∇f = (∂f/∂x, ∂f/∂y). Points in the direction of steepest ascent.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the directional derivative D_u f at a point?',
         'answer': 'D_u f = ∇f · û, where û is the unit vector in the desired direction.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the second derivative test for f(x,y): what does D = fxx·fyy − (fxy)² indicate?',
         'answer': 'D > 0 and fxx > 0 → local min; D > 0 and fxx < 0 → local max; D < 0 → saddle point; D = 0 → inconclusive.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Set up the double integral for the area of region R = {0≤x≤2, 0≤y≤3}.',
         'answer': '∫₀² ∫₀³ dy dx = ∫₀² 3 dx = 6. (Area = 6 square units)',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate: ∫₀¹ ∫₀¹ xy dy dx',
         'answer': '∫₀¹ x[y²/2]₀¹ dx = ∫₀¹ x/2 dx = [x²/4]₀¹ = 1/4.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the Jacobian for the change of variables (x,y) → (r,θ) (polar coords)?',
         'answer': 'J = r. Area element: dA = r dr dθ.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define the divergence of a vector field F = (P, Q, R).',
         'answer': 'div F = ∂P/∂x + ∂Q/∂y + ∂R/∂z.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define the curl of F = (P, Q, R).',
         'answer': 'curl F = (∂R/∂y − ∂Q/∂z, ∂P/∂z − ∂R/∂x, ∂Q/∂x − ∂P/∂y).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State Green\'s theorem.',
         'answer': '∮_C (P dx + Q dy) = ∬_D (∂Q/∂x − ∂P/∂y) dA. Relates line integral around a closed curve to double integral over enclosed region.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Divergence theorem (Gauss\'s theorem).',
         'answer': '∯_S F·dS = ∭_V (div F) dV. Flux through closed surface equals volume integral of divergence.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What does it mean for a vector field to be conservative?',
         'answer': 'F = ∇f for some scalar potential f. Equivalently, curl F = 0. Work integral is path-independent.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find all critical points of f(x,y) = x² + y² − 2x − 4y.',
         'answer': '∂f/∂x = 2x−2 = 0 → x=1; ∂f/∂y = 2y−4 = 0 → y=2. Critical point: (1, 2).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Evaluate ∬_R x dA where R is the unit disk using polar coordinates.',
         'answer': 'x = r cosθ, dA = r dr dθ. ∫₀²π ∫₀¹ r cosθ · r dr dθ = ∫₀²π cosθ dθ · ∫₀¹ r² dr = 0 (since ∫₀²π cosθ dθ = 0).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 9: Linear Algebra
    # ------------------------------------------------------------------ #
    add_cards('Linear Algebra', [
        {'question': 'What is the product of matrices A (m×n) and B (n×p)?',
         'answer': 'An m×p matrix C where Cᵢⱼ = Σₖ AᵢₖBₖⱼ. Number of columns in A must equal rows in B.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Compute the determinant of a 2×2 matrix [[a,b],[c,d]].',
         'answer': 'det = ad − bc.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'When does a square matrix have an inverse?',
         'answer': 'When det(A) ≠ 0 (A is non-singular/invertible).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the inverse of [[2, 1], [5, 3]].',
         'answer': 'det = 6−5 = 1. A⁻¹ = (1/1)[[3,−1],[−5,2]] = [[3,−1],[−5,2]].',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve Ax = b using Cramer\'s rule for 2×2: a₁₁x₁ + a₁₂x₂ = b₁, a₂₁x₁ + a₂₂x₂ = b₂.',
         'answer': 'x₁ = det(A₁)/det(A); x₂ = det(A₂)/det(A), where Aᵢ replaces column i of A with b.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is Gaussian elimination used for?',
         'answer': 'Solving systems of linear equations by row-reducing the augmented matrix [A|b] to row echelon form.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Row-reduce to solve: x + 2y = 5, 3x + y = 10.',
         'answer': 'Augmented: [[1,2|5],[3,1|10]]. R2←R2−3R1: [[1,2|5],[0,−5|−5]] → y=1, x=3.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Write augmented matrix', 'detail': '[[1,2|5],[3,1|10]]'},
                   {'move': 'R2 ← R2 − 3R1', 'detail': '[[1,2|5],[0,−5|−5]]'},
                   {'move': 'Back-substitute', 'detail': 'y = 1, then x = 5 − 2(1) = 3'}]},
        {'question': 'What is the rank of a matrix?',
         'answer': 'The number of linearly independent rows (or columns) = number of non-zero rows in row echelon form.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What is the null space (kernel) of a matrix A?',
         'answer': 'The set of all vectors x such that Ax = 0.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'How do you find eigenvalues of matrix A?',
         'answer': 'Solve the characteristic equation det(A − λI) = 0.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Find the eigenvalues of A = [[3, 1], [0, 2]].',
         'answer': 'det(A−λI) = (3−λ)(2−λ) − 0 = 0 → λ = 3 and λ = 2.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Form A − λI', 'detail': '[[3−λ, 1],[0, 2−λ]]'},
                   {'move': 'Set determinant = 0', 'detail': '(3−λ)(2−λ) = 0'},
                   {'move': 'Solve', 'detail': 'λ₁ = 3, λ₂ = 2'}]},
        {'question': 'What is an eigenvector?',
         'answer': 'A non-zero vector v such that Av = λv for some scalar eigenvalue λ. Found by solving (A − λI)v = 0.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'When is a matrix diagonalisable?',
         'answer': 'When it has n linearly independent eigenvectors (n = size of matrix). Then A = PDP⁻¹.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Cayley-Hamilton theorem.',
         'answer': 'Every square matrix satisfies its own characteristic equation. If p(λ) = 0 is the char. eq., then p(A) = 0.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What does it mean for vectors to be linearly independent?',
         'answer': 'No vector can be written as a linear combination of the others. Equivalently, c₁v₁ + c₂v₂ + ... = 0 implies all cᵢ = 0.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 10: Ordinary Differential Equations (ODEs)
    # ------------------------------------------------------------------ #
    add_cards('Ordinary Differential Equations (ODEs)', [
        {'question': 'What makes an ODE "ordinary" (vs partial)?',
         'answer': 'It involves derivatives with respect to only one independent variable.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Solve the separable ODE: dy/dx = y/x',
         'answer': 'Separate: dy/y = dx/x. Integrate: ln|y| = ln|x| + C. y = Ax (family of lines).',
         'difficulty': 'easy', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Separate variables', 'detail': 'dy/y = dx/x'},
                   {'move': 'Integrate both sides', 'detail': 'ln|y| = ln|x| + C₀'},
                   {'move': 'Exponentiate', 'detail': 'y = Ax where A = e^C₀'}]},
        {'question': 'Solve: dy/dx = ky (exponential growth/decay model).',
         'answer': 'Separable: dy/y = k dx → ln y = kx + C → y = Aeᵏˣ.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is an integrating factor and when is it used?',
         'answer': 'Used for first-order linear ODEs: dy/dx + P(x)y = Q(x). Integrating factor: μ(x) = e^(∫P dx).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve: dy/dx + 2y = 4 using an integrating factor.',
         'answer': 'μ = e²ˣ. Multiply: d/dx(e²ˣy) = 4e²ˣ. Integrate: e²ˣy = 2e²ˣ + C → y = 2 + Ce⁻²ˣ.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Identify P(x) = 2', 'detail': 'μ = e^(∫2 dx) = e^(2x)'},
                   {'move': 'Multiply ODE by μ', 'detail': 'd/dx(e^(2x)y) = 4e^(2x)'},
                   {'move': 'Integrate', 'detail': 'e^(2x)y = 2e^(2x) + C'},
                   {'move': 'Solve for y', 'detail': 'y = 2 + Ce^(−2x)'}]},
        {'question': 'State the characteristic equation for ay″ + by′ + cy = 0.',
         'answer': 'ar² + br + c = 0. Roots determine the form of the general solution.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Give the general solution of y″ − 5y′ + 6y = 0.',
         'answer': 'Char. eq: r² − 5r + 6 = (r−2)(r−3) = 0 → r = 2, 3. y = C₁e²ˣ + C₂e³ˣ.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Characteristic equation', 'detail': 'r² − 5r + 6 = 0'},
                   {'move': 'Factorise', 'detail': '(r−2)(r−3) = 0 → r = 2, 3 (real, distinct)'},
                   {'move': 'General solution', 'detail': 'y = C₁e^(2x) + C₂e^(3x)'}]},
        {'question': 'What is the general solution when the char. equation has complex roots r = α ± βi?',
         'answer': 'y = eᵅˣ(C₁cos βx + C₂sin βx).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Solve y″ + 4y = 0 (simple harmonic oscillator).',
         'answer': 'r² + 4 = 0 → r = ±2i. y = C₁cos 2x + C₂sin 2x.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the method of undetermined coefficients used for?',
         'answer': 'Finding a particular solution yₚ to non-homogeneous ODEs with right-hand side of the form polynomials, exponentials, sin, cos.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'For y″ − y = e²ˣ, guess the particular solution form.',
         'answer': 'Guess yₚ = Ae²ˣ. Substitute to find A: 4Ae²ˣ − Ae²ˣ = e²ˣ → 3A = 1 → A = 1/3.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the Wronskian and how is it used?',
         'answer': 'W(y₁,y₂) = y₁y₂′ − y₂y₁′. If W ≠ 0, y₁ and y₂ are linearly independent (form a basis for solutions).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is Newton\'s law of cooling as an ODE?',
         'answer': 'dT/dt = k(T − Tₐ), where Tₐ = ambient temperature. Solution: T(t) = Tₐ + (T₀ − Tₐ)eᵏᵗ.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is variation of parameters used for?',
         'answer': 'Finding a particular solution yₚ to any non-homogeneous linear ODE (more general than undetermined coefficients).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What is a system of ODEs? Give an example.',
         'answer': "A set of coupled ODEs, e.g. x' = ax + by, y' = cx + dy. Written in matrix form: X' = AX.",
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 11: Partial Differential Equations (PDEs)
    # ------------------------------------------------------------------ #
    add_cards('Partial Differential Equations (PDEs)', [
        {'question': 'What distinguishes a PDE from an ODE?',
         'answer': 'A PDE involves partial derivatives with respect to two or more independent variables.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Classify the second-order PDE: auxx + buxy + cuyy + ... = 0',
         'answer': 'Discriminant Δ = b² − 4ac. Δ>0: hyperbolic (wave eq); Δ=0: parabolic (heat eq); Δ<0: elliptic (Laplace eq).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the 1D heat equation.',
         'answer': '∂u/∂t = α ∂²u/∂x². Parabolic. Models diffusion of heat (or concentration).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the 1D wave equation.',
         'answer': '∂²u/∂t² = c² ∂²u/∂x². Hyperbolic. Models vibrating string, sound waves.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State Laplace\'s equation.',
         'answer': '∇²u = ∂²u/∂x² + ∂²u/∂y² = 0. Elliptic. Models steady-state temperature, potential fields.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Outline the separation of variables method for the heat equation.',
         'answer': 'Assume u(x,t) = X(x)T(t). Substitute → X″/X = T′/(αT) = −λ. Solve two ODEs separately; combine.',
         'difficulty': 'medium', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Assume product form', 'detail': 'u(x,t) = X(x)T(t)'},
                   {'move': 'Substitute into PDE', 'detail': 'X″T = αXT′ → X″/X = T′/(αT) = −λ'},
                   {'move': 'Solve spatial ODE', 'detail': 'X″ + λX = 0, apply BCs → eigenvalues λₙ'},
                   {'move': 'Solve temporal ODE', 'detail': "T' + αλₙT = 0 → T = e^(−αλₙt)"},
                   {'move': 'Superpose', 'detail': 'u = Σ Bₙ Xₙ(x) Tₙ(t), determine Bₙ from IC via Fourier'}]},
        {'question': 'What are Dirichlet boundary conditions?',
         'answer': 'The solution value u is specified on the boundary (e.g. u(0,t) = 0).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What are Neumann boundary conditions?',
         'answer': 'The normal derivative ∂u/∂n is specified on the boundary (e.g. ∂u/∂x(0,t) = 0 — insulated end).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': "State D'Alembert's solution to the wave equation with initial conditions u(x,0)=f(x), uₜ(x,0)=g(x).",
         'answer': 'u(x,t) = ½[f(x+ct) + f(x−ct)] + 1/(2c) ∫_{x−ct}^{x+ct} g(s) ds.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What role do Fourier series play in PDE solutions?',
         'answer': 'Boundary conditions determine eigenfunctions (sin/cos). Initial conditions are expanded in a Fourier series to find coefficients Bₙ.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the order and linearity of ∂u/∂t = ∂²u/∂x² + u².',
         'answer': 'Second-order (highest derivative), nonlinear (u² term). Separation of variables does not apply directly.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    # ------------------------------------------------------------------ #
    # Topic 12: Fourier Analysis
    # ------------------------------------------------------------------ #
    add_cards('Fourier Analysis', [
        {'question': 'State the Fourier series of a function f(x) with period 2L.',
         'answer': 'f(x) = a₀/2 + Σₙ₌₁^∞ [aₙcos(nπx/L) + bₙsin(nπx/L)].',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the formulas for Fourier coefficients aₙ and bₙ (period 2L).',
         'answer': 'aₙ = (1/L) ∫₋ₗᴸ f(x) cos(nπx/L) dx; bₙ = (1/L) ∫₋ₗᴸ f(x) sin(nπx/L) dx.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'How do even/odd symmetry simplify the Fourier series?',
         'answer': 'Even function: bₙ = 0 (only cosine terms). Odd function: aₙ = 0 (only sine terms).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What does Parseval\'s theorem state for Fourier series?',
         'answer': '(1/L) ∫₋ₗᴸ |f(x)|² dx = (a₀²/2) + Σₙ₌₁^∞ (aₙ² + bₙ²). Energy in time domain = energy in frequency domain.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Fourier Transform definition.',
         'answer': 'F(ω) = ∫₋∞^∞ f(t) e^(−jωt) dt.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Inverse Fourier Transform.',
         'answer': 'f(t) = (1/2π) ∫₋∞^∞ F(ω) e^(jωt) dω.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the linearity property of the Fourier Transform.',
         'answer': 'FT{af(t) + bg(t)} = aF(ω) + bG(ω).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the time-shift property: FT{f(t − t₀)}.',
         'answer': 'e^(−jωt₀) F(ω). Shift in time → phase shift in frequency.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the convolution theorem for Fourier transforms.',
         'answer': 'FT{f * g} = F(ω) · G(ω). Convolution in time ↔ multiplication in frequency.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What are the Dirichlet conditions for the existence of the Fourier series?',
         'answer': 'f(x) is periodic, piecewise continuous, has finite number of maxima/minima per period, and is absolutely integrable over one period.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What is the Fourier transform of the unit impulse δ(t)?',
         'answer': 'FT{δ(t)} = 1. The impulse has equal energy at all frequencies (white spectrum).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the frequency-shift property: FT{e^(jω₀t) f(t)}.',
         'answer': 'F(ω − ω₀). Multiplication by complex exponential → shift in frequency domain.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the Gibbs phenomenon?',
         'answer': 'The ~9% overshoot near discontinuities when a Fourier series is truncated, regardless of how many terms are used.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
    ])

    # ------------------------------------------------------------------ #
    # Topic 13: Laplace Transforms
    # ------------------------------------------------------------------ #
    add_cards('Laplace Transforms', [
        {'question': 'State the definition of the Laplace transform.',
         'answer': 'L{f(t)} = F(s) = ∫₀^∞ f(t) e^(−st) dt.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'L{1} = ?',
         'answer': '1/s (s > 0).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'L{tⁿ} = ?',
         'answer': 'n!/s^(n+1) for n = 0, 1, 2, ...',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'L{e^(at)} = ?',
         'answer': '1/(s − a) (s > a).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'L{sin(ωt)} = ? and L{cos(ωt)} = ?',
         'answer': 'L{sin ωt} = ω/(s²+ω²); L{cos ωt} = s/(s²+ω²).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the First Shifting Theorem (s-shifting).',
         'answer': 'L{e^(at)f(t)} = F(s−a). Multiply by exponential → shift in s.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Second Shifting Theorem (t-shifting).',
         'answer': 'L{f(t−a)u(t−a)} = e^(−as)F(s), where u is the unit step. Delay in time → multiply by e^(−as).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the convolution theorem for Laplace transforms.',
         'answer': 'L{(f * g)(t)} = F(s)G(s). Convolution in time ↔ multiplication in s-domain.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Initial Value Theorem.',
         'answer': 'f(0⁺) = lim(s→∞) sF(s).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Final Value Theorem.',
         'answer': 'lim(t→∞) f(t) = lim(s→0) sF(s), provided the limit exists.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Use Laplace transforms to solve: y″ + 3y′ + 2y = 0, y(0)=1, y′(0)=0.',
         'answer': '(s²Y − s) + 3(sY − 1) + 2Y = 0 → Y(s²+3s+2) = s+3 → Y = (s+3)/((s+1)(s+2)). Partial fractions: 2/(s+1) − 1/(s+2). y(t) = 2e⁻ᵗ − e⁻²ᵗ.',
         'difficulty': 'hard', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Transform ODE', 'detail': 's²Y − s·y(0) − y′(0) + 3(sY − y(0)) + 2Y = 0'},
                   {'move': 'Apply ICs', 'detail': '(s²+3s+2)Y = s + 3'},
                   {'move': 'Solve for Y', 'detail': 'Y = (s+3)/((s+1)(s+2))'},
                   {'move': 'Partial fractions', 'detail': '2/(s+1) − 1/(s+2)'},
                   {'move': 'Inverse transform', 'detail': 'y(t) = 2e^(−t) − e^(−2t)'}]},
        {'question': 'Find L⁻¹{1/(s²+4)}.',
         'answer': '(1/2) sin 2t. Use L{sin ωt} = ω/(s²+ω²) with ω=2.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the transfer function of a system?',
         'answer': 'H(s) = Y(s)/X(s) — the ratio of Laplace-transformed output to input, assuming zero initial conditions.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'L{δ(t)} = ? (unit impulse)',
         'answer': '1.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'L{u(t)} = ? (unit step)',
         'answer': '1/s.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
    ])


def reverse_fn(apps, schema_editor):
    pass


class Migration(migrations.Migration):

    dependencies = [
        ('study', '0013_seed_course_structures'),
    ]

    operations = [
        migrations.RunPython(seed_flashcards, reverse_fn),
    ]
