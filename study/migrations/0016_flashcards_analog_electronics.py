from django.db import migrations


def seed_flashcards(apps, schema_editor):
    User = apps.get_model('auth', 'User')
    Course = apps.get_model('study', 'Course')
    Topic = apps.get_model('study', 'Topic')
    Flashcard = apps.get_model('study', 'Flashcard')

    system_user = User.objects.filter(username='system').first()
    if not system_user:
        return
    course = Course.objects.filter(name='Analog Electronics', created_by=system_user).first()
    if not course:
        return
    topics = {t.name: t for t in Topic.objects.filter(course=course)}

    def add_cards(topic_name, cards):
        topic = topics.get(topic_name)
        if not topic or Flashcard.objects.filter(topic=topic).exists():
            return
        for card in cards:
            Flashcard.objects.create(topic=topic, **card)

    add_cards('Signals & Amplifiers', [
        {'question': 'Define voltage gain Av of an amplifier.',
         'answer': 'Av = Vout/Vin. Often expressed in dB: AdB = 20 log₁₀|Av|.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is the power gain in dB?',
         'answer': 'Ap(dB) = 10 log₁₀(Pout/Pin) = 10 log₁₀(Av × Ai).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'An amplifier has Av = 200. What is the gain in dB?',
         'answer': '20 log₁₀(200) = 20 × 2.301 = 46 dB.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Describe the Thevenin amplifier model.',
         'answer': 'Input: Rin in parallel with input terminals. Output: dependent voltage source Av×Vin in series with Rout.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Why does high input resistance and low output resistance matter?',
         'answer': 'High Rin: minimal loading of source (Vin ≈ Vsource). Low Rout: delivers maximum voltage to load (Vout ≈ Av×Vin even with small RL).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Define the −3dB bandwidth of an amplifier.',
         'answer': 'The frequency range over which gain ≥ Amax/√2 (i.e., power ≥ half max). BW = fH − fL.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define gain-bandwidth product (GBP).',
         'answer': 'GBP = Av × BW. For a single-pole amplifier, GBP is constant — increasing gain reduces bandwidth.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What is the difference between a voltage amplifier, current amplifier, and transconductance amplifier?',
         'answer': 'Voltage amp: Vin→Vout (Av). Current amp: Iin→Iout (Ai). Transconductance: Vin→Iout (Gm). Transresistance: Iin→Vout (Rm).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
    ])

    add_cards('Operational Amplifiers', [
        {'question': 'State the two ideal op-amp rules.',
         'answer': '1) V⁺ = V⁻ (virtual short: input differential voltage = 0). 2) I⁺ = I⁻ = 0 (infinite input impedance: no current into inputs).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Gain of the inverting op-amp amplifier.',
         'answer': 'Av = −Rf/R₁. Output is inverted relative to input.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Gain of the non-inverting op-amp amplifier.',
         'answer': 'Av = 1 + Rf/R₁. Output is in phase with input.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is a unity-gain buffer (voltage follower)?',
         'answer': 'Non-inverting amp with Rf=0 and R₁=∞: Av=1. Very high Rin, very low Rout — used for impedance matching.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Summing amplifier output with inputs V₁, V₂ through R₁, R₂, feedback Rf.',
         'answer': 'Vout = −Rf(V₁/R₁ + V₂/R₂). Weighted sum (inverted).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Difference amplifier: output for V₁ on inverting, V₂ on non-inverting (all equal resistors R).',
         'answer': 'Vout = V₂ − V₁. CMRR is key — rejects common-mode signals.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Ideal integrator op-amp circuit: output in terms of input.',
         'answer': 'Vout(t) = −(1/RC) ∫ Vin dt. Feedback element is capacitor C; input resistor R.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Ideal differentiator op-amp circuit: output.',
         'answer': 'Vout(t) = −RC dVin/dt. Input element is capacitor C; feedback resistor R.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define CMRR (Common Mode Rejection Ratio).',
         'answer': 'CMRR = Ad/Acm, where Ad = differential gain, Acm = common-mode gain. High CMRR rejects noise common to both inputs.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define slew rate of an op-amp.',
         'answer': 'Maximum rate of change of output voltage: SR = dVout/dt|max. Typically measured in V/μs. Limits performance at high frequencies.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'An inverting amplifier has R₁=1kΩ, Rf=10kΩ. Find Av and output for Vin=0.5V.',
         'answer': 'Av = −10. Vout = −10 × 0.5 = −5V.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
    ])

    add_cards('Diodes', [
        {'question': 'State the Shockley diode equation.',
         'answer': 'ID = IS(e^(VD/VT) − 1), where VT = kT/q ≈ 26mV at room temperature (300K).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Typical forward voltage of a silicon diode.',
         'answer': '≈ 0.7V (at standard current). For Ge diode: ≈ 0.3V.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Describe the ideal diode model.',
         'answer': 'Short circuit when forward biased (ID ≥ 0), open circuit when reverse biased (VD < 0). Simple for hand analysis.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Describe the constant voltage drop diode model.',
         'answer': 'Diode = ideal diode in series with 0.7V battery. Better approximation than ideal model.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Half-wave rectifier: peak output voltage (ideal diode, Vs = Vm sin ωt).',
         'answer': 'Vp = Vm (ideal) or Vm − 0.7V (constant VD model). Conducts only positive half cycles.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Full-wave bridge rectifier: peak output voltage.',
         'answer': 'Vp = Vm − 2×0.7 = Vm − 1.4V (two diodes in series conduct each half cycle).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Ripple voltage formula for a rectifier with capacitor filter.',
         'answer': 'Vr ≈ Vp/(fRC) where f = supply frequency (100Hz for full-wave at 50Hz), R = load, C = filter cap.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is Zener breakdown and how is it used?',
         'answer': 'Zener diode conducts in reverse at a precise Vz (breakdown voltage). Used as shunt voltage regulator: place Zener in parallel with load, with series resistor.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Design a Zener regulator: Vs=12V, Vz=5V, IL=20mA. Find series resistor R.',
         'answer': 'VR = 12 − 5 = 7V. Assume IZ(min) ≈ 5mA. I_total = 25mA. R = 7/0.025 = 280Ω.',
         'difficulty': 'hard', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Voltage across R', 'detail': 'VR = Vs − Vz = 7V'},
                   {'move': 'Total current (load + min Zener)', 'detail': 'I = IL + IZ = 20+5 = 25mA'},
                   {'move': 'Find R', 'detail': 'R = VR/I = 7/0.025 = 280Ω'}]},
        {'question': 'What is the small-signal diode resistance rd?',
         'answer': 'rd = VT/ID. At ID=1mA: rd = 26mV/1mA = 26Ω. Lower ID → higher rd.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Describe a clipping circuit with a diode and reference voltage.',
         'answer': 'Clips (limits) the output to a reference level. For positive clipper: when Vin > Vref, diode conducts and Vout = Vref. Below Vref: Vout = Vin.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
    ])

    add_cards('MOSFETs', [
        {'question': 'What is the threshold voltage Vtn of an nMOS transistor?',
         'answer': 'The minimum VGS required to create an inversion layer (channel) and allow drain current to flow.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What are the two operating regions of a MOSFET (above threshold)?',
         'answer': 'Triode (linear): VDS < VGS − Vtn. Saturation: VDS ≥ VGS − Vtn (channel pinched off).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Drain current in MOSFET saturation region.',
         'answer': 'ID = (kn/2)(VGS − Vtn)². Where kn = μnCox(W/L). Independent of VDS (ideal).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Drain current in MOSFET triode region.',
         'answer': 'ID = kn[(VGS − Vtn)VDS − VDS²/2]. Increases with VDS.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define transconductance gm of a MOSFET.',
         'answer': 'gm = ∂ID/∂VGS|VDS=const = kn(VGS − Vtn) = 2ID/(VGS−Vtn) = √(2knID).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define output resistance ro of a MOSFET (Early effect).',
         'answer': 'ro = |VA|/ID where VA is the Early voltage. Accounts for channel-length modulation (slight increase in ID with VDS).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Describe the MOSFET small-signal model.',
         'answer': 'Gate: open circuit. gm·vgs dependent current source from drain to source. ro from drain to source. No Cgs/Cgd in mid-band model.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'How does a pMOS transistor differ from nMOS?',
         'answer': 'pMOS: VGS < Vtp (Vtp < 0), VSD > 0, current flows from source to drain. Holes are carriers. IV characteristic mirrors nMOS.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Describe the operation of a CMOS inverter.',
         'answer': 'nMOS and pMOS in series. Vin=HIGH → nMOS on, pMOS off → Vout=LOW. Vin=LOW → pMOS on, nMOS off → Vout=HIGH. Static power ≈ 0.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What is the body effect in MOSFETs?',
         'answer': 'Source-to-body reverse bias increases Vtn (for nMOS). Vtn = Vtn0 + γ(√(2φF+VSB) − √(2φF)).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'A MOSFET has kn=2mA/V², Vtn=1V. Find ID when VGS=3V in saturation.',
         'answer': 'ID = (2/2)(3−1)² = 1×4 = 4mA.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    add_cards('Bipolar Junction Transistors (BJTs)', [
        {'question': 'State the conditions for BJT active (forward-active) region.',
         'answer': 'BE junction forward biased (VBE ≈ 0.7V); BC junction reverse biased (VCE > VCE,sat ≈ 0.2V).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'BJT collector current equation in active region.',
         'answer': 'IC = IS × e^(VBE/VT). Also IC = β × IB.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Define β (current gain) and α for a BJT.',
         'answer': 'β = IC/IB (common-emitter current gain). α = IC/IE = β/(β+1) (common-base current gain). IE = IC + IB.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'BJT transconductance gm.',
         'answer': 'gm = IC/VT. At IC=1mA: gm = 1mA/26mV ≈ 38.5 mA/V.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'BJT small-signal input resistance rπ.',
         'answer': 'rπ = β/gm = VT/IB.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'BJT small-signal model (T-model or hybrid-π).',
         'answer': 'Hybrid-π: rπ between B and E; gm·vbe current source from C to E; ro from C to E.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Describe the four-resistor bias network for a BJT.',
         'answer': 'R1 and R2 form a voltage divider to set VB. RE provides emitter degeneration for stability. RC is the collector load. VB ≈ Vcc×R2/(R1+R2).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'DC bias analysis: find IC for BJT with VCC=12V, R1=10kΩ, R2=5kΩ, RE=1kΩ, β=100.',
         'answer': 'VB = 12×5/15 = 4V. VE = 4 − 0.7 = 3.3V. IE = 3.3/1k = 3.3mA. IC ≈ IE = 3.3mA.',
         'difficulty': 'hard', 'question_type': 'step_by_step', 'uses_latex': True,
         'steps': [{'move': 'Find VB via voltage divider', 'detail': 'VB = 12 × 5k/(10k+5k) = 4V'},
                   {'move': 'Find VE', 'detail': 'VE = VB − VBE = 4 − 0.7 = 3.3V'},
                   {'move': 'Find IE', 'detail': 'IE = VE/RE = 3.3V/1kΩ = 3.3mA'},
                   {'move': 'Approximate IC', 'detail': 'IC ≈ αIE ≈ IE = 3.3mA (for large β)'}]},
        {'question': 'What is the Early effect in BJTs?',
         'answer': 'IC increases slightly with VCE due to base-width modulation. ro = VA/IC where VA is Early voltage (typically 50–200V).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'BJT in saturation: what are the conditions and VCE,sat?',
         'answer': 'Both BE and BC junctions are forward biased. VCE,sat ≈ 0.1–0.2V. IB > IC/β (forced β < rated β).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'PNP BJT: how do polarities differ from NPN?',
         'answer': 'All currents and voltages reversed: VEB > 0 (not VBE), current flows from E to C, IE = IC + IB all flow into E (conventional).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
    ])

    add_cards('Transistor Amplifiers', [
        {'question': 'Voltage gain of common-emitter (CE) BJT amplifier (no RE bypass).',
         'answer': 'Av = −gm(RC∥ro) ≈ −gmRC. Negative sign = phase inversion.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Input resistance of common-emitter BJT amplifier.',
         'answer': 'Rin = R1∥R2∥rπ.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Voltage gain of common-base (CB) BJT amplifier.',
         'answer': 'Av ≈ +gmRC (positive). Very low input resistance (≈ 1/gm), high output resistance.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Voltage gain of emitter follower (common-collector) BJT.',
         'answer': 'Av ≈ RE/(RE + 1/gm) ≈ 1 for large RE. High Rin, low Rout — used as buffer.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Voltage gain of common-source (CS) MOSFET amplifier.',
         'answer': 'Av = −gm(RD∥ro) ≈ −gmRD.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Voltage gain of source follower (common-drain) MOSFET.',
         'answer': 'Av ≈ gmRS/(1 + gmRS) ≈ 1. Low Rout ≈ 1/gm, high Rin.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Why is a cascode amplifier used?',
         'answer': 'High output resistance, reduced Miller effect, wider bandwidth, good for high-frequency or high-gain stages.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'How does a current mirror work?',
         'answer': 'Reference transistor Q1 is diode-connected (VBE1 set by Iref). Q2 copies this VBE → IC2 = IC1 × (W/L)₂/(W/L)₁.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Effect of emitter degeneration resistance RE on CE amplifier.',
         'answer': 'Av ≈ −RC/RE (reduced gain but improved linearity and stability). Rin increases: Rin ≈ β(RE + 1/gm).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    add_cards('Frequency Response of Amplifiers', [
        {'question': 'What is the Miller effect?',
         'answer': 'An impedance Z connected between input and output of an inverting amplifier appears at the input as Z/(1−Av), effectively multiplying capacitance by (1−Av).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Miller capacitance for Cgd in a CS amplifier with gain Av.',
         'answer': 'Cin,Miller = Cgd(1 − Av) = Cgd(1 + |Av|). Dominates high-frequency input capacitance.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What limits the high-frequency response of an amplifier?',
         'answer': 'Parasitic capacitances (Cgs, Cgd for MOSFETs; Cπ, Cμ for BJTs) and Miller effect. Create poles that reduce gain above fH.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'What limits the low-frequency response of an amplifier?',
         'answer': 'Coupling capacitors (block DC) and bypass capacitors create poles at low frequencies. Gain rolls off below fL.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Unity-gain frequency fT of a BJT.',
         'answer': 'fT = gm/(2π(Cπ + Cμ)). Frequency at which current gain |hfe| = 1.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the open-circuit time constant method for finding fH.',
         'answer': 'fH ≈ 1/(2π ΣᵢCᵢRᵢ) where Rᵢ is the resistance seen by each capacitor Cᵢ with all other caps open-circuited.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Why does gain-bandwidth product remain constant?',
         'answer': 'A single dominant pole: gain × BW = gm/(2πCL) = constant. Reducing gain increases bandwidth by the same factor.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])

    add_cards('Feedback Amplifiers', [
        {'question': 'State the four feedback topologies and their effect on Rin and Rout.',
         'answer': 'Series-series: ↑Rin, ↑Rout. Series-shunt: ↑Rin, ↓Rout. Shunt-series: ↓Rin, ↑Rout. Shunt-shunt: ↓Rin, ↓Rout.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'How does negative feedback affect gain?',
         'answer': 'Closed-loop gain Af = A/(1 + Aβ). The factor (1+Aβ) is the "desensitivity" factor — gain reduced but more stable.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'How does negative feedback affect bandwidth?',
         'answer': 'Bandwidth increases by (1+Aβ): BWf = BW(1+Aβ). GBP remains constant.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'How does negative feedback affect nonlinear distortion?',
         'answer': 'Distortion is reduced by factor (1+Aβ). Feedback linearises the amplifier.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'State the Barkhausen criterion for oscillation.',
         'answer': 'Loop gain |Aβ| = 1 and total phase shift around loop = 0° (or 360°). If |Aβ| > 1, oscillations grow; < 1, decay.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'How do you identify the feedback topology in a circuit?',
         'answer': 'At input: series if feedback added to input loop (voltage subtr.); shunt if at input node (current subtr.). At output: shunt samples voltage; series samples current.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': False},
    ])

    add_cards('Filters & Tuned Amplifiers', [
        {'question': 'First-order low-pass filter transfer function.',
         'answer': 'H(s) = K·ωp/(s + ωp), or H(jω) = K/(1 + j·ω/ωp). −20dB/dec roll-off above ωp.',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Second-order Butterworth low-pass: H(s) with ωn = 1 rad/s (normalised).',
         'answer': 'H(s) = 1/(s² + √2·s + 1). Maximally flat in passband (Q = 1/√2 = 0.707).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Sallen-Key LP filter: component relationships for Butterworth response.',
         'answer': 'With equal R and C: Q = 0.5/(2−K), where K = 1+Rf/Rg. For Butterworth: K = 1.586, giving Q = 0.707.',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Chebyshev vs Butterworth filter trade-off.',
         'answer': 'Chebyshev: steeper roll-off but has ripple in passband. Butterworth: maximally flat (no ripple) but gentler roll-off.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Band-pass filter Q factor definition.',
         'answer': 'Q = f₀/BW = ω₀/(ω₂−ω₁). High Q → narrow bandwidth, sharp selectivity.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'What is a notch (band-reject) filter?',
         'answer': 'Rejects a narrow band of frequencies around ω₀. Transfer function has a zero at ω₀. Used to remove interference (e.g. 50Hz hum).',
         'difficulty': 'easy', 'question_type': 'standard', 'uses_latex': False},
        {'question': 'Describe an active second-order BP filter using op-amp.',
         'answer': 'Multiple feedback (MFB) topology: two capacitors and three resistors. H(s) = −(R₂/R₁)·s/(s² + 2α·s + ω₀²).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
    ])

    add_cards('Oscillators', [
        {'question': 'State the Barkhausen criterion for a sinusoidal oscillator.',
         'answer': 'Loop gain = 1: |A(jω)β(jω)| = 1 and ∠A(jω)β(jω) = 0° at the oscillation frequency.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Wien bridge oscillator frequency.',
         'answer': 'f₀ = 1/(2πRC). Requires op-amp gain of 3 (Rf = 2R₁).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Phase shift oscillator: how many RC stages, and what phase per stage?',
         'answer': 'Three RC stages, each contributing 60° phase shift at the oscillation frequency (total 180° + 180° from inverting amp = 360°).',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Colpitts oscillator: tank circuit and frequency.',
         'answer': 'Two capacitors C₁, C₂ in series with inductor L. f₀ = 1/(2π√(LCeq)), Ceq = C₁C₂/(C₁+C₂).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Hartley oscillator: tank circuit and frequency.',
         'answer': 'Two inductors L₁, L₂ in series with capacitor C. f₀ = 1/(2π√((L₁+L₂)C)).',
         'difficulty': 'hard', 'question_type': 'standard', 'uses_latex': True},
        {'question': 'Why is crystal oscillator frequency so stable?',
         'answer': 'Crystal has extremely high Q factor (10⁴ to 10⁶) and very stable resonant frequency vs temperature. Used for clock generation.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': False},
        {'question': '555 timer in astable mode: frequency formula.',
         'answer': 'f = 1.44/((R₁ + 2R₂)C). Duty cycle = (R₁+R₂)/(R₁+2R₂) × 100%.',
         'difficulty': 'medium', 'question_type': 'standard', 'uses_latex': True},
    ])


def reverse_fn(apps, schema_editor):
    pass


class Migration(migrations.Migration):

    dependencies = [
        ('study', '0015_flashcards_circuit_analysis'),
    ]

    operations = [
        migrations.RunPython(seed_flashcards, reverse_fn),
    ]
